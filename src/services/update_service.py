# src/services/update_service.py

import pickle


class UpdateService:
    """處理資料更新的服務層"""
    
    def __init__(self, containers):
        self.containers = containers
        
    async def update_technical_rag(self):
        """更新技術 RAG 資料"""
        container_name = "sample_question"
        container = self.containers.lookup_db.get_container_client(container_name)
        query = "SELECT * FROM c"
        results = container.query_items(query, enable_cross_partition_query=True)

        new_rag_mappings, new_rag_hint_id_index_mapping = {}, {}
        ASUS_link = "https://www.asus.com/{}/support/FAQ/{}"
        ROG_link = "https://rog.asus.com/{}/support/FAQ/{}"

        for item in results:
            key = f"{item.get('kb_no')}_{item.get('websitecode')}_{item.get('index')}"
            new_rag_mappings[key] = {
                "id": item.get("id"),
                "question": item.get("question"),
                "rag_response": item.get("rag"),
                "title": item.get("title"),
                "ASUS_link": ASUS_link.format(item.get("websitecode"), item.get("kb_no")),
                "ROG_link": ROG_link.format(item.get("websitecode"), item.get("kb_no"))
            }
            key2 = f"{item.get('id')}_{item.get('websitecode')}"
            new_rag_hint_id_index_mapping[key2] = {
                "index": item.get("index"),
                "rag": item.get("rag")
            }

        self.containers.rag_mappings = new_rag_mappings
        self.containers.rag_hint_id_index_mapping = new_rag_hint_id_index_mapping

        # 儲存到檔案
        with open("config/rag_hint_id_index_mapping.pkl", "wb") as file:
            pickle.dump(self.containers.rag_hint_id_index_mapping, file)
        with open("config/rag_mappings.pkl", "wb") as file:
            pickle.dump(self.containers.rag_mappings, file)

        return {"message": "rag_mappings update success"}

    def update_website_botname(self):
        """更新網站機器人名稱對應"""
        #  為了測試 copilot 暫時不跑 gina
        # container_name = "all_websitecode_productline"
        # container = self.containers.lookup_db.get_container_client(container_name)

        # query = """SELECT * FROM c"""
        # # results = container.query_items(query, enable_cross_partition_query=True)

        # new_PL_mappings = {}
        # new_productline_name_map = {}
        # for item in results:
        #     if not new_PL_mappings.get(item.get("websiteCode")):
        #         new_PL_mappings[item.get("websiteCode")] = set()
        #         new_productline_name_map[item.get("websiteCode")] = {}
        #     new_PL_mappings[item.get("websiteCode")].add(item.get("productLine"))
        #     new_productline_name_map[item.get("websiteCode")][item.get("productLine")] = item.get("productLine_name")

        # self.containers.PL_mappings = new_PL_mappings
        self.containers.PL_mappings = {'ar': {'notebook', 'phone', 'chromebook', 'proart', 'motherboard'}, 'au': {'notebook', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc'}, 'bd': {'notebook', 'phone', 'pad', 'nuc'}, 'be-fr': {'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory'}, 'be-nl': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'nuc', 'lcd', 'motherboard'}, 'br': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'chromebook', 'lcd', 'nuc', 'motherboard'}, 'ca-en': {'graphics', 'notebook', 'proart_lcd', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'desktop', 'proart_nb', 'motherboard'}, 'ca-fr': {'graphics', 'notebook', 'proart_lcd', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'desktop', 'proart_nb', 'motherboard'}, 'ch-de': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'pad', 'desktop', 'motherboard'}, 'ch-en': {'notebook', 'phone', 'wireless', 'chromebook', 'nuc', 'desktop', 'motherboard'}, 'ch-fr': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'motherboard'}, 'cl': {'notebook', 'phone', 'chromebook', 'proart', 'motherboard'}, 'co': {'notebook', 'phone', 'wireless', 'nuc', 'lcd', 'motherboard'}, 'co ': {'chromebook', 'aio'}, 'cz': {'graphics', 'notebook', 'phone', 'wireless', 'chromebook', 'lcd', 'nuc', 'proart', 'pad', 'accessory', 'motherboard'}, 'de': {'graphics', 'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'pad', 'accessory', 'desktop', 'motherboard'}, 'dk': {'graphics', 'notebook', 'desktoo_lcd', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'accessory', 'motherboard'}, 'eg': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'nuc', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}, 'es': {'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'proart', 'pad', 'accessory', 'desktop', 'motherboard'}, 'fi': {'graphics', 'notebook', 'desktoo_lcd', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'accessory', 'motherboard'}, 'fr': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'motherboard'}, 'global': {'graphics', 'aio_chrome', 'wearable', 'notebook', 'gaming_nb', 'phone', 'gaming_handhelds', 'wireless', 'nuc', 'lcd', 'pad', 'desktop', 'motherboard'}, 'hk': {'notebook', 'phone', 'wireless', 'chromebook', 'nuc'}, 'hu': {'graphics', 'notebook', 'phone', 'wireless', 'nuc', 'pad', 'accessory', 'motherboard'}, 'id': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'proart', 'desktop', 'motherboard'}, 'il': {'graphics', 'notebook', 'phone', 'wireless', 'chromebook', 'lcd', 'nuc', 'accessory', 'desktop', 'proart_nb', 'motherboard'}, 'in': {'notebook', 'gaming_nb', 'phone', 'chromebook', 'nuc', 'proart', 'motherboard'}, 'it': {'aio', 'graphics', 'notebook', 'mini_pc', 'gaming_handhelds', 'phone', 'wireless', 'chromebook', 'lcd', 'nuc', 'accessory', 'desktop', 'motherboard'}, 'jp': {'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'proart', 'pad', 'desktop'}, 'kh': {'notebook', 'phone', 'nuc', 'desktop', 'motherboard'}, 'kr': {'notebook', 'gaming_handhelds', 'chromebook', 'nuc', 'pad'}, 'latin': {'notebook', 'phone', 'chromebook', 'nuc', 'proart', 'motherboard'}, 'lk': {'graphics', 'notebook', 'chromebook', 'lcd', 'motherboard'}, 'me-ar': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}, 'me-en': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}, 'mx': {'notebook', 'phone', 'chromebook', 'nuc', 'proart', 'motherboard'}, 'my': {'notebook', 'phone', 'wireless', 'chromebook', 'nuc'}, 'nl': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'accessory', 'motherboard'}, 'no': {'graphics', 'notebook', 'desktoo_lcd', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'accessory', 'motherboard'}, 'nz': {'notebook', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc'}, 'pe': {'notebook', 'phone', 'chromebook', 'proart', 'motherboard'}, 'ph': {'graphics', 'notebook', 'phone', 'chromebook', 'nuc', 'desktop', 'motherboard'}, 'pl': {'graphics', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'accessory', 'desktop', 'motherboard'}, 'pt': {'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'proart', 'pad', 'accessory', 'desktop', 'motherboard'}, 'ro': {'aio_chrome', 'graphics', 'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}, 'sa-en': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}, 'se': {'graphics', 'notebook', 'desktoo_lcd', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'accessory', 'motherboard'}, 'sg': {'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc'}, 'sk': {'graphics', 'notebook', 'phone', 'wireless', 'chromebook', 'lcd', 'nuc', 'pad', 'motherboard'}, 'th': {'notebook', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'motherboard'}, 'tr': {'notebook', 'phone', 'wireless', 'nuc', 'lcd', 'accessory', 'desktop', 'motherboard'}, 'tw': {'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'lcd', 'nuc', 'zenbo', 'pad', 'desktop', 'motherboard'}, 'ua-ua': {'aio', 'graphics', 'notebook', 'phone', 'wireless', 'chromebook', 'nuc', 'proart', 'accessory', 'desktop_lcd', 'motherboard'}, 'uk': {'aio_chrome', 'graphics', 'wearable', 'notebook', 'phone', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'accessory', 'desktop_lcd', 'motherboard'}, 'us': {'graphics', 'notebook', 'proart_lcd', 'gaming_handhelds', 'wireless', 'chromebook', 'nuc', 'pad', 'desktop', 'proart_nb', 'motherboard'}, 'vn': {'graphics', 'notebook', 'phone', 'wireless', 'nuc', 'lcd', 'desktop', 'motherboard'}, 'za': {'aio_chrome', 'graphics', 'notebook', 'phone', 'wireless', 'chromebook', 'nuc', 'pad', 'accessory', 'desktop_lcd', 'motherboard'}}
        # self.containers.productline_name_map = new_productline_name_map
        self.containers.productline_name_map = {'ar': {'chromebook': 'Chromebook', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'phone': 'ZenPhone', 'proart': 'ProArt'}, 'au': {'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming handhelds', 'lcd': 'Display', 'notebook': 'Notebook', 'nuc': 'NUC', 'wireless': 'Networking'}, 'bd': {'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone'}, 'be-fr': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'ZenFone', 'wireless': 'Wireless'}, 'be-nl': {'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'Grafische kaart ', 'lcd': 'LCD', 'motherboard': 'Moederbord', 'notebook': 'Notebook', 'nuc': 'NUC ', 'phone': 'ZenFone'}, 'br': {'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'Video card', 'lcd': 'LCD', 'motherboard': 'Main Board ', 'notebook': 'Laptop', 'nuc': 'NUC', 'phone': 'ZenPhone'}, 'ca-en': {'chromebook': 'Chromebook', 'desktop': 'Chrome, Desktop, AIO PC, Mini PC,  Robot', 'gaming_handhelds': 'Gaming Handheld', 'graphics': 'Graphics Card, Display, Accessory, Other Components', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC', 'pad': 'Tablet, Mobile Phone, and Wearable', 'proart_lcd': 'ProArt Display', 'proart_nb': 'ProArt Studiobook and ProArt Mini PC', 'wireless': 'Networking'}, 'ca-fr': {'chromebook': 'Chromebook', 'desktop': 'Chrome, Desktop, AIO PC, Mini PC,  Robot', 'gaming_handhelds': 'Gaming Handheld', 'graphics': 'Graphics Card, Display, Accessory, Other Components', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC', 'pad': 'Tablet, Mobile Phone, and Wearable', 'proart_lcd': 'ProArt Display', 'proart_nb': 'ProArt Studiobook and ProArt Mini PC', 'wireless': 'Networking'}, 'ch-de': {'chromebook': 'Chromebook', 'desktop': 'DT', 'gaming_handhelds': 'Gaming Handhelds', 'lcd': 'LCD Monitore', 'motherboard': 'Mainboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'Smartphones', 'wearable': 'Smartwatch', 'wireless': 'Netzwerkprodukte'}, 'ch-en': {'chromebook': 'Chromebook', 'desktop': 'DT', 'motherboard': 'Mainboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'phone': 'ZenFone', 'wireless': 'Wireless/Router'}, 'ch-fr': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'ZenFone', 'wireless': 'Wireless'}, 'cl': {'chromebook': 'Chromebook', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'phone': 'ZenPhone', 'proart': 'ProArt'}, 'co': {'lcd': 'Monitores', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'nuc': 'NUC ', 'phone': 'ZenPhone', 'wireless': 'Routers'}, 'co ': {'aio': 'AIO/Desktop', 'chromebook': 'Chromebook'}, 'cz': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'graphics': 'VGA', 'lcd': 'LCD a PC komponenty', 'motherboard': 'Motherboard', 'notebook': 'Notebooky', 'nuc': 'NUC ', 'pad': 'Tablety', 'phone': 'PadFone/ZenFone', 'proart': 'ProArt', 'wireless': 'Wireless'}, 'de': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop': 'DT', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'lcd': 'LCD Monitore', 'motherboard': 'Mainboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'Smartphones', 'wearable': 'Smartwatch', 'wireless': 'Netzwerkprodukte'}, 'dk': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktoo_lcd': 'DT/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'phone': 'Phone/Phonepad', 'wireless': 'Wireless'}, 'eg': {'accessory': 'Accessory', 'desktop_lcd': 'Desktop/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'motherboard': 'MB/VGA/Projector/ODD/Oplay', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone/PhonePad', 'wearable': 'Wearable', 'wireless': 'Wireless/Router'}, 'es': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop': 'DT/AIO/EB', 'gaming_handhelds': 'Consola de videojuegos', 'lcd': 'LCD', 'motherboard': 'MB/VGA', 'notebook': 'Portátil', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone', 'proart': 'ProArt Series', 'wireless': 'WLAN'}, 'fi': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktoo_lcd': 'DT/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'phone': 'Phone/Phonepad', 'wireless': 'Wireless/Network'}, 'fr': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'ZenFone', 'wireless': 'Wireless'}, 'global': {'aio_chrome': 'AIO/Chromebox', 'desktop': 'Chrome, Desktop, AIO PC, Mini PC,  Robot', 'gaming_handhelds': 'Gaming Handheld', 'gaming_nb': 'Gaming Notebook', 'graphics': 'Graphics Card, Display, Accessory, Other Components', 'lcd': 'Display', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC', 'pad': 'Pad', 'phone': 'Phone', 'wearable': 'Wearable', 'wireless': 'Networking'}, 'hk': {'chromebook': 'Chromebook', 'notebook': '筆記型電腦', 'nuc': 'NUC 電腦', 'phone': 'Zenfone 和 ROG Phone', 'wireless': 'Wireless'}, 'hu': {'accessory': 'Accessory', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Tablet', 'phone': 'Mobile', 'wireless': 'Wireless'}, 'id': {'chromebook': 'Chromebook', 'desktop': 'DESKTOP/All in One PC', 'gaming_handhelds': 'Gaming handhelds', 'graphics': 'VGA', 'lcd': 'LCD Monitor', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'phone': 'Smart Phone', 'proart': 'ProArt Series', 'wireless': 'Wireless'}, 'il': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop': 'AIO/DT', 'graphics': 'Graphic Card', 'lcd': 'LCD', 'motherboard': 'Motherboard', 'notebook': 'NB', 'nuc': 'NUC ', 'phone': 'Phone', 'wireless': 'Wireless', 'proart_nb': 'NB ProArt'}, 'in': {'chromebook': 'Chromebook', 'gaming_nb': 'Gaming Notebook', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC', 'phone': 'Phone', 'proart': 'ProArt Series'}, 'it': {'accessory': 'Accessory', 'aio': 'ALL IN ONE - MINI PC', 'chromebook': 'Chromebook', 'desktop': 'DESKTOP', 'gaming_handhelds': 'GAMING HANDHELDS - ROG ALLY', 'graphics': 'VGA', 'lcd': 'LCD - PROJECTORS', 'mini_pc': 'COMPONENTS - VIVOPC', 'motherboard': 'Motherboard', 'notebook': 'NOTEBOOK', 'nuc': 'NUC ', 'phone': 'TABLET - SMARTPHONE', 'wireless': 'NETWORKING - WIFI - HIFI'}, 'jp': {'chromebook': 'Chromebook', 'desktop': 'AIO/DT', 'gaming_handhelds': 'ポータブルゲーム機', 'lcd': 'ディスプレイ', 'notebook': 'ノートパソコン', 'nuc': 'NUC ', 'pad': 'タブレット', 'phone': 'スマートフォン', 'proart': 'ProArt Series', 'wireless': '無線ルーター'}, 'kh': {'desktop': 'Desktop PC', 'motherboard': 'Mother board', 'notebook': 'Notebook', 'nuc': 'NUC', 'phone': 'ZENFONE'}, 'kr': {'chromebook': 'Chromebook', 'gaming_handhelds': '게이밍 핸드헬드', 'notebook': '노트북', 'nuc': 'NUC ', 'pad': '패드'}, 'latin': {'chromebook': 'Chromebook', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'nuc': 'NUC ', 'phone': 'ZenPhone', 'proart': 'ProArt'}, 'lk': {'chromebook': 'Commercial notebook', 'graphics': 'Graphic card', 'lcd': 'LCD Monitor', 'motherboard': 'Mother board', 'notebook': 'Notebook series'}, 'me-ar': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'motherboard': 'MB/VGA/Projector/ODD/Oplay', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone/PhonePad', 'wearable': 'Wearable', 'wireless': 'Wireless/Router'}, 'me-en': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'motherboard': 'MB/VGA/Projector/ODD/Oplay', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone/PhonePad', 'wearable': 'Wearable', 'wireless': 'Wireless/Router'}, 'mx': {'chromebook': 'Chromebook', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'nuc': 'NUC ', 'phone': 'ZenPhone', 'proart': 'ProArt'}, 'my': {'chromebook': 'Chromebook', 'notebook': 'Notebook', 'nuc': 'NUC', 'phone': 'Premium Phone', 'wireless': 'Networking'}, 'nl': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'Grafische kaart ', 'lcd': 'LCD', 'motherboard': 'Moederbord', 'notebook': 'Notebook', 'nuc': 'NUC ', 'phone': 'ZenFone', 'wireless': 'Wireless'}, 'no': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktoo_lcd': 'DT/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'phone': 'Phone/Phonepad', 'wireless': 'Wireless/Network'}, 'nz': {'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming handhelds', 'lcd': 'Display', 'notebook': 'Notebook', 'nuc': 'NUC', 'wireless': 'Networking'}, 'pe': {'chromebook': 'Chromebook', 'motherboard': 'Main Board / Video card', 'notebook': 'Laptop', 'phone': 'ZenPhone', 'proart': 'ProArt'}, 'ph': {'chromebook': 'Chromebook', 'desktop': 'Desktop PC', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Laptops', 'nuc': 'NUC', 'phone': 'Zenfones'}, 'pl': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop': 'AIO/Desktop', 'gaming_handhelds': 'Konsola', 'graphics': 'VGA', 'lcd': 'Monitor LCD', 'motherboard': 'Motherboard', 'notebook': 'Laptop', 'nuc': 'NUC ', 'phone': 'Zenfone', 'wireless': 'Wireless'}, 'pt': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop': 'DT/AIO/EB', 'gaming_handhelds': 'Console de jogos', 'lcd': 'LCD', 'motherboard': 'MB/VGA', 'notebook': 'NB/EPC', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone', 'proart': 'ProArt Series', 'wireless': 'WLAN'}, 'ro': {'accessory': 'Accessory', 'aio_chrome': 'AIO/Chromebox', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD', 'gaming_handhelds': 'Console Portabile', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'pad': 'Pad', 'phone': 'Mobile', 'wearable': 'Wearable', 'wireless': 'Wireless'}, 'sa-en': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'motherboard': 'MB/VGA/Projector/ODD/Oplay', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Phone/PhonePad', 'wearable': 'Wearable', 'wireless': 'Wireless/Router'}, 'se': {'accessory': 'Accessory', 'chromebook': 'Chromebook', 'desktoo_lcd': 'DT/LCD/AIO/Chromebox', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'phone': 'Phone/Phonepad', 'wireless': 'Wireless/Network'}, 'sg': {'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming handhelds', 'notebook': 'Notebook', 'nuc': 'NUC', 'phone': 'Phone', 'wireless': 'Networking'}, 'sk': {'chromebook': 'Chromebook', 'graphics': 'VGA', 'lcd': 'LCD a PC komponenty', 'motherboard': 'Motherboard', 'notebook': 'Notebooky', 'nuc': 'NUC ', 'pad': 'Tablety', 'phone': 'PadFone/ZenFone', 'wireless': 'Wireless'}, 'th': {'chromebook': 'Chromebook', 'gaming_handhelds': 'Gaming Handhelds', 'motherboard': 'Motherboards', 'notebook': 'Notebook series', 'nuc': 'NUC ', 'wireless': 'Wireless'}, 'tr': {'accessory': 'Accessory', 'desktop': 'Masaustu & AIO', 'lcd': 'LCD & Monitör', 'motherboard': 'MOBO & GPU', 'notebook': 'Dizüstü & Ultrabook', 'nuc': 'NUC ', 'phone': 'Tablet & Mobil', 'wireless': 'Ağ Ürünleri'}, 'tw': {'chromebook': 'Chromebook', 'desktop': '桌上型電腦', 'gaming_handhelds': '電競掌機', 'lcd': '顯示器/投影機', 'motherboard': '主機板/顯示卡/週邊配件', 'notebook': '筆記型電腦', 'nuc': 'NUC電腦/NUC主機板', 'pad': '平板電腦', 'phone': '智慧型手機', 'wearable': '穿戴裝置', 'wireless': '無線分享器', 'zenbo': 'Zenbo / Zenbo Junior'}, 'ua-ua': {'accessory': 'Аксесуар', 'aio': 'Моноблоки', 'chromebook': 'Chromebook', 'desktop_lcd': 'Десктопи/Монітори (підтримка материнських плат та відеокарт здійснюється через офіційний сайт ASUS)', 'graphics': 'VGA', 'motherboard': 'Материнська плата', 'notebook': 'Ноутбуки', 'nuc': 'NUC ', 'phone': 'Смартфони', 'proart': 'Пристрої серії ProArt', 'wireless': 'Бездротовий'}, 'uk': {'accessory': 'Accessory', 'aio_chrome': 'AIO/Chromebox', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD', 'gaming_handhelds': 'Gaming Handhelds', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'phone': 'Phone', 'wearable': 'Wearable', 'wireless': 'Wireless'}, 'us': {'chromebook': 'Chromebook', 'desktop': 'Chrome, Desktop, AIO PC, Mini PC,  Robot', 'gaming_handhelds': 'Gaming Handheld', 'graphics': 'Graphics Card, Display, Accessory, Other Components', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC', 'pad': 'Tablet, Mobile Phone, and Wearable', 'proart_lcd': 'ProArt Display', 'proart_nb': 'ProArt Studiobook and ProArt Mini PC', 'wireless': 'Networking'}, 'vn': {'desktop': 'DESKTOP', 'graphics': 'VGA', 'lcd': 'LCD', 'motherboard': 'Motherboard', 'notebook': 'NB', 'nuc': 'Mini PC NUC', 'phone': 'ZENFONE', 'wireless': 'Wireless'}, 'za': {'accessory': 'Accessory', 'aio_chrome': 'AIO/Chromebox', 'chromebook': 'Chromebook', 'desktop_lcd': 'Desktop/LCD', 'graphics': 'VGA', 'motherboard': 'Motherboard', 'notebook': 'Notebook', 'nuc': 'NUC ', 'pad': 'Pad', 'phone': 'Mobile', 'wireless': 'Wireless'}}
        
        return {"message": "PL_mappings update success"}

    def update_KB(self):
        """更新知識庫資料"""
        container_name = "ApChatbotKnowledge"
        container = self.containers.lookup_db.get_container_client(container_name)

        query = """SELECT * FROM c"""
        results = container.query_items(query, enable_cross_partition_query=True)

        new_KB_mappings = {
            f"{item.get('kb_no')}_{item.get('lang')}": {
                "title": item.get("title"),
                "summary": item.get("summary"),
                "content": item.get("content")[:10000],
            }
            for item in results
        }

        self.containers.KB_mappings = new_KB_mappings
        
        # 儲存到檔案
        with open("config/kb_mappings.pkl", "wb") as file:
            pickle.dump(self.containers.KB_mappings, file)
        
        return {"message": "KB_mappings update success"}

    def update_specific_KB(self):
        """更新特定知識庫對應"""
        # gina 為了測試copilot 暫時不跑 gina
        # container_name = "specific_kb_bot_scope"
        # container = self.containers.lookup_db.get_container_client(container_name)

        # query = """SELECT * FROM c"""
        # results = container.query_items(query, enable_cross_partition_query=True)

        # new_specific_kb_mappings = {
        #     f"{item.get('kb_no')}_{item.get('bot_scope')}": {
        #         "id": item.get("id"),
        #         "correct_kb_no": int(item.get("correct_kb_no")),
        #     }
        #     for item in results
        # }

        # self.containers.specific_kb_mappings = new_specific_kb_mappings
        self.containers.specific_kb_mappings = {'1015071_desktop': {'id': '0', 'correct_kb_no': 1047955}, '1047955_gaming_handhelds': {'id': '1', 'correct_kb_no': 1015071}, '1047955_notebook': {'id': '2', 'correct_kb_no': 1015071}, '1015072_desktop': {'id': '3', 'correct_kb_no': 1047158}, '1015072_motherboard': {'id': '4', 'correct_kb_no': 1047158}, '1047158_gaming_handhelds': {'id': '5', 'correct_kb_no': 1015072}, '1047158_notebook': {'id': '6', 'correct_kb_no': 1015072}, '1015073_desktop': {'id': '7', 'correct_kb_no': 1015740}, '1015740_gaming_handhelds': {'id': '8', 'correct_kb_no': 1015073}, '1015740_notebook': {'id': '9', 'correct_kb_no': 1015073}}
        
        return {"message": "Specific_KB_mappings update success"}
